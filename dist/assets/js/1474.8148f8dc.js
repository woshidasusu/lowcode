"use strict";(self["webpackChunklowcode"]=self["webpackChunklowcode"]||[]).push([[1474],{38615:function(t,e,n){function o(t=""){const e=document.createElement("textarea");e.style.position="absolute",e.style.bottom=0,e.style.left=0,e.style.opacity=0,document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e)}n.d(e,{Q:function(){return o}})},51474:function(t,e,n){n.r(e),n.d(e,{default:function(){return b}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"layout-container"},[e("div",{staticClass:"title-container"},[e("span",{staticClass:"title"},[t._v("比对本地和服务器的元数据")]),e("div",{staticStyle:{"margin-left":"20px"}},[t.showOldDiffPage?[e("span",[t._v("总共有 "+t._s(t.diffIndexs.length||0)+" 行不同")]),e("el-button",{attrs:{type:"text"},on:{click:t.jumpDiff}},[t._v(" 快速定位差异点 "),t.curJumpIndex>-1?e("span",[t._v("(第"+t._s(+t.diffIndexs[t.curJumpIndex]+1)+"行)")]):t._e()])]:[e("span",[t._v("总共有 "+t._s(t.diffNode.length||0)+" 处改动")]),e("el-button",{attrs:{type:"text"},on:{click:t.handleDiffJump}},[t._v(" 快速定位差异点 "),t.curJumpIndex>-1?e("span",[t._v("(第"+t._s(t.curJumpIndex+1)+"处改动)")]):t._e()])],e("el-button",{attrs:{type:"text"},on:{click:t.doTransform}},[t._v(" 格式转换成 JSON 字符串（提供给后端去写 sql 更新服务端元数据） ")]),e("el-button",{attrs:{type:"text"},on:{click:t.switchDiffPage}},[t._v(" 切换对比页面 ")])],2)]),t.showOldDiffPage?e("div",{staticClass:"code-container"},t._l(t.maxRow,(function(n){return e("div",{key:n,staticClass:"row",class:t.diffIndexMap[n-1]?"diff":""},[e("div",{staticClass:"index"},[t._v(t._s(n))]),e("div",{staticClass:"item"},[t._v(t._s(t.localMetadata[n-1]))]),e("div",{staticClass:"item"},[t._v(t._s(t.remoteMetadata[n-1]))])])})),0):e("div",{staticClass:"code-container"},t._l(t.lineList,(function(n,o){return e("pre",{key:o,class:["regular"!==n.type?"diff":"",n.type]},[t._v(t._s(n.value))])})),0)])},i=[],s=(n(6484),n(38615));function r(){}function a(t,e,n,o,i){for(var s=0,r=e.length,a=0,u=0;s<r;s++){var l=e[s];if(l.removed){if(l.value=t.join(o.slice(u,u+l.count)),u+=l.count,s&&e[s-1].added){var c=e[s-1];e[s-1]=e[s],e[s]=c}}else{if(!l.added&&i){var d=n.slice(a,a+l.count);d=d.map((function(t,e){var n=o[u+e];return n.length>t.length?n:t})),l.value=t.join(d)}else l.value=t.join(n.slice(a,a+l.count));a+=l.count,l.added||(u+=l.count)}}var f=e[r-1];return r>1&&"string"===typeof f.value&&(f.added||f.removed)&&t.equals("",f.value)&&(e[r-2].value+=f.value,e.pop()),e}function u(t){return{newPos:t.newPos,components:t.components.slice(0)}}r.prototype={diff:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.callback;"function"===typeof n&&(o=n,n={}),this.options=n;var i=this;function s(t){return o?(setTimeout((function(){o(void 0,t)}),0),!0):t}t=this.castInput(t),e=this.castInput(e),t=this.removeEmpty(this.tokenize(t)),e=this.removeEmpty(this.tokenize(e));var r=e.length,l=t.length,c=1,d=r+l;n.maxEditLength&&(d=Math.min(d,n.maxEditLength));var f=[{newPos:-1,components:[]}],p=this.extractCommon(f[0],e,t,0);if(f[0].newPos+1>=r&&p+1>=l)return s([{value:this.join(e),count:e.length}]);function h(){for(var n=-1*c;n<=c;n+=2){var o=void 0,d=f[n-1],p=f[n+1],h=(p?p.newPos:0)-n;d&&(f[n-1]=void 0);var m=d&&d.newPos+1<r,v=p&&0<=h&&h<l;if(m||v){if(!m||v&&d.newPos<p.newPos?(o=u(p),i.pushComponent(o.components,void 0,!0)):(o=d,o.newPos++,i.pushComponent(o.components,!0,void 0)),h=i.extractCommon(o,e,t,n),o.newPos+1>=r&&h+1>=l)return s(a(i,o.components,e,t,i.useLongestToken));f[n]=o}else f[n]=void 0}c++}if(o)(function t(){setTimeout((function(){if(c>d)return o();h()||t()}),0)})();else while(c<=d){var m=h();if(m)return m}},pushComponent:function(t,e,n){var o=t[t.length-1];o&&o.added===e&&o.removed===n?t[t.length-1]={count:o.count+1,added:e,removed:n}:t.push({count:1,added:e,removed:n})},extractCommon:function(t,e,n,o){var i=e.length,s=n.length,r=t.newPos,a=r-o,u=0;while(r+1<i&&a+1<s&&this.equals(e[r+1],n[a+1]))r++,a++,u++;return u&&t.components.push({count:u}),t.newPos=r,a},equals:function(t,e){return this.options.comparator?this.options.comparator(t,e):t===e||this.options.ignoreCase&&t.toLowerCase()===e.toLowerCase()},removeEmpty:function(t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(t[n]);return e},castInput:function(t){return t},tokenize:function(t){return t.split("")},join:function(t){return t.join("")}};new r;var l=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,c=/\S/,d=new r;d.equals=function(t,e){return this.options.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t===e||this.options.ignoreWhitespace&&!c.test(t)&&!c.test(e)},d.tokenize=function(t){for(var e=t.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),n=0;n<e.length-1;n++)!e[n+1]&&e[n+2]&&l.test(e[n])&&l.test(e[n+2])&&(e[n]+=e[n+2],e.splice(n+1,2),n--);return e};var f=new r;function p(t,e,n){return f.diff(t,e,n)}f.tokenize=function(t){var e=[],n=t.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var o=0;o<n.length;o++){var i=n[o];o%2&&!this.options.newlineIsToken?e[e.length-1]+=i:(this.options.ignoreWhitespace&&(i=i.trim()),e.push(i))}return e};var h=new r;h.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var m=new r;function v(t){return v="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}m.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};var g=Object.prototype.toString,y=new r;function w(t,e,n,o,i){var s,r;for(e=e||[],n=n||[],o&&(t=o(i,t)),s=0;s<e.length;s+=1)if(e[s]===t)return n[s];if("[object Array]"===g.call(t)){for(e.push(t),r=new Array(t.length),n.push(r),s=0;s<t.length;s+=1)r[s]=w(t[s],e,n,o,i);return e.pop(),n.pop(),r}if(t&&t.toJSON&&(t=t.toJSON()),"object"===v(t)&&null!==t){e.push(t),r={},n.push(r);var a,u=[];for(a in t)t.hasOwnProperty(a)&&u.push(a);for(u.sort(),s=0;s<u.length;s+=1)a=u[s],r[a]=w(t[a],e,n,o,a);e.pop(),n.pop()}else r=t;return r}y.useLongestToken=!0,y.tokenize=f.tokenize,y.castInput=function(t){var e=this.options,n=e.undefinedReplacement,o=e.stringifyReplacer,i=void 0===o?function(t,e){return"undefined"===typeof e?n:e}:o;return"string"===typeof t?t:JSON.stringify(w(t,null,null,i),i,"  ")},y.equals=function(t,e){return r.prototype.equals.call(y,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};var x=new r;x.tokenize=function(t){return t.slice()},x.join=x.removeEmpty=function(t){return t};var C={components:{},props:{},data(){return{metadata:null,localMetadata:[],remoteMetadata:[],diffIndexMap:{},curJumpIndex:-1,lineList:[],diffNode:[],showOldDiffPage:!1}},computed:{maxRow(){return this.localMetadata&&this.remoteMetadata?Math.max(this.localMetadata.length,this.remoteMetadata.length):0},diffIndexs(){return Object.keys(this.diffIndexMap)}},watch:{maxRow(t){this.diffIndexMap={};for(let e=0;e<t;e++)this.localMetadata[e]!==this.remoteMetadata[e]&&(this.diffIndexMap[e]=!0)}},async mounted(){let t=localStorage.getItem("__metadata");t=JSON.parse(t),this.metadata=t?.metadata,this.localMetadata=JSON.stringify(t?.metadata," ",2).split("\n"),this.remoteMetadata=JSON.stringify(JSON.parse(t?.standard)," ",2).split("\n");const{resultList:e,diffList:n}=this.handleDiff(JSON.stringify(JSON.parse(t?.standard)," ",2),JSON.stringify(t?.metadata," ",2));this.lineList=e,this.diffNode=n},destroyed(){},methods:{jumpDiff(){if(!this.diffIndexs.length)return this.$message.success("没有找到差异");this.curJumpIndex++;const t=30*(this.diffIndexs[this.curJumpIndex]-1);window.scrollTo(0,t)},doTransform(){(0,s.Q)(JSON.stringify(JSON.stringify(this.metadata))),this.$message.success("格式转换并复制成功")},switchDiffPage(){this.showOldDiffPage=!this.showOldDiffPage,this.curJumpIndex=-1,window.scrollTo(0,0)},handleDiff(t,e){const n=p(t,e),o=[],i=[];for(let s=0;s<n.length;s++){if(n[s].added&&n[s+1]&&n[s+1].removed){const t=n[s];n[s]=n[s+1],n[s+1]=t}const t={};n[s].removed?(t.type="del",i.push(t)):n[s].added?(t.type="ins",i.push(t)):t.type="regular",t.value=n[s].value,o.push(t)}return{resultList:o,diffList:i}},handleDiffJump(){if(this.curJumpIndex>=this.diffNode.length-1)return;this.curJumpIndex++;const t=document.querySelectorAll(".diff"),e=t[this.curJumpIndex];window.scrollTo(0,e.offsetTop-document.body.clientHeight/2)}}},_=C,I=n(9512),J=(0,I.Z)(_,o,i,!1,null,"5b020225",null),b=J.exports}}]);