"use strict";(self["webpackChunklowcode"]=self["webpackChunklowcode"]||[]).push([[2235],{32235:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var o=function(){var e=this,t=e._self._c;return t("el-table",e._g(e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,total:e.total,page:e.page,"page-size":e.pageSize,"default-columns":e.formTemplate.defaultColumns||["index"]},on:{pageChange:e.loadDataByPage},scopedSlots:e._u([e.formTemplate.operateBtnSlot&&e.formTemplate.operateBtnSlot.slotName?{key:"operateBtn",fn:function(t){return[e._t(e.formTemplate.operateBtnSlot.slotName,null,{metadata:e.formTemplate.operateBtnSlot,formModel:e.formModel,tableData:t})]}}:null],null,!0)},"el-table",e.formTemplate.$props,!1),e.onEvents),[e._l(e.tableColumns,(function(a,o){return[a.slotName||a.headerSlot&&a.headerSlot.slotName?t("el-table-column",e._b({key:a.prop||a.slotName||o,scopedSlots:e._u([a.headerSlot&&a.headerSlot.slotName?{key:"header",fn:function(){return[e._t(a.headerSlot.slotName,null,{metadata:a.headerSlot,formModel:e.formModel})]},proxy:!0}:null,{key:"default",fn:function(t){return a.slotName?[e._t(a.slotName,null,{metadata:a,row:t.row,formModel:e.formModel})]:void 0}}],null,!0)},"el-table-column",a,!1)):t("el-table-column",e._b({key:a.prop||o,attrs:{prop:a.prop}},"el-table-column",a,!1))]}))],2)},r=[],l=(a(6484),{components:{},inject:["getStore"],props:{metadata:{type:Object,require:!0},formModel:{type:[Object,Array],default:()=>({})},parentModelName:{type:String,default:""}},data(){return{loading:!1,tableData:[],total:0,page:1,updateColumnStatus:1}},computed:{formTemplate(){return this.metadata||{}},onEvents(){const e={};return this.metadata?._id&&this.metadata?.$on?.forEach((t=>{e[t]=this.handleEvent.bind(this,t,this.metadata._id)})),e},coreProcessor(){return this.getStore()?.state()?.coreProcessor},pageSize(){return this.formTemplate.pageSize||10},grayPublish(){return this.$store.state.app.grayPublish||{}},tableColumns(){const e=(this.formTemplate.components||[]).filter((e=>!+e.deleted)).map((e=>{let t=e.hidden;return e.showWhen&&(t=!Object.keys(e.showWhen).every((t=>{if(!Array.isArray(e.showWhen[t]))return this.formModel[t]===e.showWhen[t];{const[a,o,...r]=e.showWhen[t];switch(a){case">":return this.formModel[t]>o||r.some((e=>this.formModel[t]>e));case">=":return this.formModel[t]>=o||r.some((e=>this.formModel[t]>=e));case"<":return this.formModel[t]<o||r.some((e=>this.formModel[t]<e));case"<=":return this.formModel[t]<=o||r.some((e=>this.formModel[t]<=e));case"==":return this.formModel[t]==o||r.some((e=>this.formModel[t]==e));case"===":return this.formModel[t]===o||r.some((e=>this.formModel[t]===e));case"!=":return this.formModel[t]!=o||r.some((e=>this.formModel[t]!=e));case"!==":return this.formModel[t]!==o||r.some((e=>this.formModel[t]!==e));case"grayPublish":return this.grayPublish[t]===o||r.some((e=>this.grayPublish[t]===e));default:return!0}}}))),{...e,hidden:t}})).filter((e=>!+e.hidden));return this.updateColumnStatus&&e}},watch:{"formTemplate.refreshEvent":{handler:function(e){this.loadDataByPage()}},"formTemplate.updateCloumnsEvent":{handler:function(e){this.updateColumnStatus++}}},mounted(){this.loadDataByPage()},methods:{handleComponentEvent(...e){this.$emit("event",...e)},handleEvent(e,t,a){this.$emit("event",e,t,a)},async loadDataByPage(e=1){if(this.formTemplate._id&&this.handleEvent("pageChange",this.formTemplate._id,e),!this.formTemplate.dataSource)return void console.error("[tableContainer] 未配置 dataSource");const t=null!=this.formTemplate.asyncTotalDataSource?.type;t&&this.asyncFetchTotaL(),this.loading=!0,this.page=e;let a={};try{const{dataSource:t}=this.formTemplate;t.params=t.params||[],t.params.push({type:"constant",key:"page",value:e},{type:"constant",key:"pageSize",value:this.pageSize}),a=await this.coreProcessor.parseDataSource(t)}catch(o){console.error(o)}finally{this.loading=!1}0===a.errcode&&a.data?(this.tableData=a.data.items||a.data.item||[],t||(this.total=a.data.total)):(t||(this.total=0),this.tableData=[]),this.formTemplate._id&&this.handleEvent("dataChange",this.formTemplate._id,a.data),t||this.formTemplate._id&&this.handleEvent("totalChange",this.formTemplate._id,a.data)},async asyncFetchTotaL(){let e={};try{const{asyncTotalDataSource:t}=this.formTemplate;e=await this.coreProcessor.parseDataSource(t)}catch(t){console.error(t)}0===e.errcode&&e.data?this.total=e.data.total:this.total=0,this.formTemplate._id&&this.handleEvent("totalChange",this.formTemplate._id,e.data)}}}),s=l,n=a(9512),i=(0,n.Z)(s,o,r,!1,null,"12894183",null),m=i.exports}}]);