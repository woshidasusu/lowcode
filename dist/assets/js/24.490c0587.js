"use strict";(self["webpackChunklowcode"]=self["webpackChunklowcode"]||[]).push([[24],{40024:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var i=function(){var e=this,t=e._self._c;return t("el-form-item",{attrs:{label:e.formTemplate.label,prop:e.parentModelName+e.formTemplate.name,"label-width":e.formTemplate.labelWidth,required:!!+e.formTemplate.required,rules:[...e.formTemplate.validateRules||[],{required:!!+e.formTemplate.required,message:e.formTemplate.label+"不能为空"}]}},[t("el-select",e._g(e._b({style:{width:e.formTemplate.width||"100%"},attrs:{placeholder:e.formTemplate.placeholder||`请选择${e.formTemplate.label||""}`,multiple:!!+e.formTemplate.multiple,disabled:!!+e.formTemplate.disabled,clearable:!!+e.formTemplate.clearable,filterable:!!+e.formTemplate.filterable,size:"medium"},model:{value:e.insideModel,callback:function(t){e.insideModel=t},expression:"insideModel"}},"el-select",e.formTemplate.$props,!1),e.onEvents),e._l(e.options,(function(a,i){return t("el-option",{key:i,attrs:{label:a[e.fieldConfig.key],value:a[e.fieldConfig.value],disabled:!!+a.disabled}})})),1)],1)},o=[];const l=window.__debug_log__,s=(...e)=>{l&&console.log("[objectSelect]：",...e)};var r={inject:["getStore"],props:{metadata:{type:Object,require:!0},formModel:{type:Object,default:()=>({})},parentModelName:{type:String,default:""}},data(){return{options:[],defaultFieldConfig:{key:"label",value:"value"},insideModel:""}},computed:{formTemplate(){return this.metadata||{}},fieldConfig(){return this.metadata&&this.metadata.dataSource&&this.metadata.dataSource.fieldConfig||this.defaultFieldConfig},model(){return this.formTemplate.name?this.formModel[this.formTemplate.name]:[]},coreProcessor(){return this.getStore()?.state()?.coreProcessor},onEvents(){const e={};return this.metadata?._id&&(e.change=this.handleEvent.bind(this,"change",this.metadata._id),this.metadata?.$on?.forEach((t=>{e[t]=this.handleEvent.bind(this,t,this.metadata._id)}))),e},optionItemMap(){const e={};return this.options.forEach((t=>e[t[this.fieldConfig.value]]=t)),e},fieldConfigInSelected(){return{id:this.formTemplate.fieldConfig?.id||"id",name:this.formTemplate.fieldConfig?.name||"name"}}},watch:{metadata:{handler:function(e){this.parseMetadata()},immediate:!0},"metadata.dataSource":{handler:async function(e,t){const a=await this.coreProcessor.parseDataSource(e);this.options=a||[]}},model:{handler:function(e){Array.isArray(e)?this.insideModel=e.map((e=>e[this.fieldConfigInSelected.id])):"object"===typeof e&&(this.insideModel=e&&e[this.fieldConfigInSelected.id])},immediate:!0}},methods:{async parseMetadata(){if(!this.validateMetadata())return;s("validateMetadata() return true");const{dataSource:e}=this.metadata;this.options=await this.coreProcessor.parseDataSource(e),this.options=this.options||[];let t=!!+this.metadata.isSelectFirst;null!=e.isSelectFirst&&(t=!!+e.isSelectFirst),t&&this.options.length&&!this.model&&(this.model=this.options[0][this.fieldConfig.value])},validateMetadata(){if(!this.metadata||"object"!==typeof this.metadata)return!1;const{dataSource:e}=this.metadata;return!(!e||"object"!==typeof e)||(console.error("select 表单组件的 dataSource 字段不能为空"),!1)},handleEvent(e,t,a){let i=a;Array.isArray(a)?i=i.map((e=>({...this.optionItemMap[e],[this.fieldConfigInSelected.id]:this.optionItemMap[e][this.fieldConfig.value],[this.fieldConfigInSelected.name]:this.optionItemMap[e][this.fieldConfig.key]}))):a&&"string"===typeof a&&(i={...this.optionItemMap[a],[this.fieldConfigInSelected.id]:this.optionItemMap[a][this.fieldConfig.value],[this.fieldConfigInSelected.name]:this.optionItemMap[a][this.fieldConfig.key]}),this.formTemplate.name&&(this.formModel[this.formTemplate.name]=i),this.$emit("event",e,t,i)}}},n=r,d=a(9512),m=(0,d.Z)(n,i,o,!1,null,"8455f57a",null),f=m.exports}}]);