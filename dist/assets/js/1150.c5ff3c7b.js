"use strict";(self["webpackChunklowcode"]=self["webpackChunklowcode"]||[]).push([[1150],{61104:function(e,t,a){t.Z={checkboxGroup:()=>a.e(6443).then(a.bind(a,36443)),container:()=>a.e(991).then(a.bind(a,90991)),dynamicContainer:()=>a.e(1293).then(a.bind(a,61293)),dataContainer:()=>Promise.resolve().then(a.bind(a,56593)),formContainer:()=>a.e(9397).then(a.bind(a,49397)),tableContainer:()=>a.e(2235).then(a.bind(a,32235)),datePicker:()=>a.e(3564).then(a.bind(a,43564)),dateRange:()=>a.e(5259).then(a.bind(a,35259)),hidden:()=>a.e(6735).then(a.bind(a,36735)),input:()=>a.e(8717).then(a.bind(a,48717)),inputNumber:()=>a.e(9570).then(a.bind(a,69570)),dynamicInput:()=>a.e(5076).then(a.bind(a,95076)),radioGroup:()=>a.e(2961).then(a.bind(a,22961)),select:()=>a.e(8793).then(a.bind(a,78793)),objectSelect:()=>a.e(24).then(a.bind(a,40024)),search:()=>a.e(2200).then(a.bind(a,42200)),switch:()=>a.e(2958).then(a.bind(a,62958)),text:()=>a.e(7531).then(a.bind(a,98826)),textarea:()=>a.e(5174).then(a.bind(a,85174)),title:()=>a.e(1401).then(a.bind(a,91401)),element:()=>a.e(8630).then(a.bind(a,38630)),slot:()=>a.e(638).then(a.bind(a,50638)),tabs:()=>a.e(5438).then(a.bind(a,55438))}},92559:function(e,t){t.Z={}},56593:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var s=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{height:"inherit"}},[e._l(e.formTemplate.components,(function(a,s){return[a._id&&!+a.hidden?e._t("before"+a._id,null,{formModel:e.insideFormModel},e.metadataMap["before"+a._id]):e._e(),"slot2"===a.type?[+a.hidden?e._e():e._t(a.slotName,null,{formModel:e.insideFormModel},a)]:+a.hidden?e._e():t(e.ALL_COMPONENTS[a.type]||e.ALL_COMPONENTS["element"],e._b({key:s,ref:a._id,refInFor:!0,tag:"component",style:a.style,attrs:{metadata:a,"form-model":e.insideFormModel,"parent-model-name":e.wholeModelName,type:a.type},on:{event:e.handleComponentEvent},scopedSlots:e._u([e._l(e.slots,(function(t){return{key:t,fn:function(a){return[e._t(t,null,null,a)]}}}))],null,!0)},"component",e.$attrs,!1)),a._id&&!+a.hidden?e._t("after"+a._id,null,{formModel:e.insideFormModel},e.metadataMap["after"+a._id]):e._e()]}))],2)},r=[],o=a(61104),n={inject:["getStore"],props:{metadata:{type:Object,require:!0},formModel:{type:[Object,Array],default:()=>({})},parentModelName:{type:String,default:""}},data(){return{ALL_COMPONENTS:o.Z,initRulesMap:{},metadataMap:{},eventListenerMap:{}}},computed:{formTemplate(){return this.metadata||{}},slots(){return Object.keys(this.$scopedSlots)},insideFormModel(){let e=this.formModel;return this.formTemplate.name&&(e=this.formModel[this.formTemplate.name]),Array.isArray(e)?e[0]:e},coreProcessor(){return this.getStore()?.state()?.coreProcessor},wholeModelName(e){let t=this.parentModelName||"";return this.formTemplate.name&&(t+=this.formTemplate.name,Array.isArray(this.formModel[this.formTemplate.name])&&(t+="[0]"),t+="."),t},isArrayContainer(){return this.wholeModelName.indexOf("[")>-1}},watch:{metadata:{handler:function(e,t){this.parseMetadata()},immediate:!0}},methods:{parseMetadata(){if(this.isArrayContainer){if(this.metadata?.components){const e=this.coreProcessor?.getInfoByParseComponents(this.metadata.components)||{};this.initRulesMap=e._initRulesMap,this.metadataMap=e._metadataMap,this.eventListenerMap=e._eventListenerMap,this.updateStoreData(),this.coreProcessor?.handleInitRules(e)}}else this.metadataMap=this.coreProcessor?.getMetadataMap()},handleComponentEvent(...e){this.isArrayContainer&&this.updateStoreData(),this.$emit("event",...e)},updateStoreData(){this.coreProcessor?.updateFormModelMap(Object.keys(this.metadataMap),this.insideFormModel),this.coreProcessor?.updateMetadataMap(this.metadataMap),this.coreProcessor?.updateEventListenerMap(this.eventListenerMap)}}},i=n,c=a(9512),l=(0,c.Z)(i,s,r,!1,null,"5ccb562e",null),d=l.exports},11270:function(e,t,a){a.d(t,{Z:function(){return ke}});var s=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},["formPage"===e.type?t("form-page",e._g(e._b({ref:"formPageRef",scopedSlots:e._u([e._l(e.slots,(function(t){return{key:t,fn:function(a){return[e._t(t,null,null,a)]}}}))],null,!0)},"form-page",e.$attrs,!1),e.$listeners)):"listPage"===e.type?t("list-page",e._g(e._b({ref:"listPageRef",scopedSlots:e._u([e._l(e.slots,(function(t){return{key:t,fn:function(a){return[e._t(t,null,null,a)]}}}))],null,!0)},"list-page",e.$attrs,!1),e.$listeners)):e._e()],1)},r=[],o=function(){var e=this,t=e._self._c;return t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"formRef",staticClass:"form-container",attrs:{"label-width":e.formTemplate.labelWidth,model:e.formModel,rules:e.formTemplate.validateRules}},[e._l(e.components,(function(a,s){return[a._id&&!+a.hidden?e._t("before"+a._id,null,{formModel:e.formModel},e.metadataMap["before"+a._id]):e._e(),"slot2"===a.type?[+a.hidden?e._e():e._t(a.slotName,null,{formModel:e.formModel},a)]:+a.hidden?e._e():t(e.ALL_COMPONENTS[a.type]||e.ALL_COMPONENTS["element"],{key:s,ref:a._id,refInFor:!0,tag:"component",style:a.style,attrs:{metadata:a,"form-model":e.formModel,type:a.type},on:{event:e.handleComponentEvent},scopedSlots:e._u([e._l(e.slots,(function(t){return{key:t,fn:function(a){return[e._t(t,null,null,a)]}}}))],null,!0)}),a._id&&!+a.hidden?e._t("after"+a._id,null,{formModel:e.formModel},e.metadataMap["after"+a._id]):e._e()]})),e._t("footer-btns",(function(){return[t("div",{staticClass:"footer-btns",style:{"margin-left":e.formTemplate.labelWidth,"margin-bottom":"40px"}},[e._l(e.formTemplate.footerBtns,(function(a,s){return[+a.hidden?e._e():t("el-button",{key:s,staticStyle:{"min-width":"88px"},attrs:{disabled:!!+a.disabled,size:"medium",type:a.nativeType,plain:!!+e.formTemplate.plain},on:{click:function(t){return e.onFooterBtnClick(a.type)}}},[e._v(e._s(a.text))])]}))],2)]}))],2)},n=[],i=a(61104),c=a(35026),l=(a(6484),a(71587));class d{constructor(e,t){(0,c.Z)(this,"coreProcessor",new pe),(0,c.Z)(this,"condition",void 0),this.coreProcessor=e,this.condition=t}async exec(){return!1}log(...e){window.__debug_log__&&console.log(`[condition/${this.condition.type}]`,...e)}}class h extends d{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"eventData",void 0),this.eventData=a}async exec(){this.log("exec() start, condition =",this.condition,"eventData =",this.eventData);const e=this.coreProcessor.getExpresstion(this.condition,{eventData:this.eventData}),t=await e.exec();return this.log("exec() return",t),t}}class u extends d{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"args",void 0),this.args={$event:a}}exec(){this.log("exec() start, condition =",this.condition,"eventData =",this.eventData);const{functionBody:e}=this.condition;if(this.args&&"object"!==typeof this.args)throw new TypeError("args is not a object");let t=new Function("args",e);return t(this.args)}}class p extends d{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"eventData",void 0),this.eventData=a}async exec(){this.log("exec() start, condition =",this.condition,"eventData =",this.eventData);const{serviceName:e,args:t}=this.condition,a=this.coreProcessor.getDataService();if(a)try{const s=await a.exec(e,{...t,$event:this.eventData});return this.log("exec() return",s),s}catch(s){console.error("[DataServiceCondition]",s)}else console.error("[DataServiceCondition] - exec() error, cause dataService is null")}}class m extends d{async exec(){this.log("exec() start, condition =",this.condition);const{code:e,value:t}=this.condition,a=this.coreProcessor.getGrayPublish(),s=a[e]===t;return this.log("exec() return",s),s}}function v(e,t,a={}){const{type:s}=t,r={expression:h,execFunction:u,dataService:p,grayPublish:m}[s];return new r(e,t,a)}class f{constructor(e,t,a){(0,c.Z)(this,"coreProcessor",new pe),(0,c.Z)(this,"dataSource",void 0),(0,c.Z)(this,"eventData",void 0),this.coreProcessor=e,this.dataSource=t,this.eventData=a.eventData}async exec(){}log(...e){window.__debug_log__&&console.log(`[dataSource/${this.dataSource.type}]`,...e)}async parseDataAfterFetched(e){const{parseServiceName:t}=this.dataSource;if(t){const a=this.coreProcessor.getDataService(),s=await a.exec(t,{$event:e});return s}return e}getQuery(e=null,t=location.href,a=null,s=!1,r=!1){const o=t.split("?"),n=a||o[1];if(!n)return e?void 0:{};let i,c;const l={},d=n.split("&"),h=d.length;for(let p=0;p<h;p++)try{i=d[p].split("="),2===i.length&&(c=r?i[1]:decodeURIComponent(i[1]),l[i[0]]=c)}catch(u){console.error("[getQuery]",u)}return e?l[e]:l}}class g extends f{async exec(){this.log("exec() start, dataSource =",this.dataSource,"eventData =",this.eventData);const{dataKey:e}=this.dataSource,t=e||"options",a=this.dataSource[t];return this.log("exec() return",a),a}}class y extends f{async exec(){this.log("exec() start, dataSource =",this.dataSource,"eventData =",this.eventData);const{symbol:e,dataKey:t}=this.dataSource;let a=window;if(e&&(a=window[Symbol.for(e)]),t){const e=t.split(".");while(e.length>0){if(null==a){console.error("[WindowDataSource]",t+" 读取异常，请检查数据结构");break}const s=e.shift();a=a[s]}}return this.log("exec() return",a),a}}class x extends f{async exec(){this.log("exec() start, dataSource =",this.dataSource,"eventData =",this.eventData);const{params:e}=this.dataSource;let t={};e&&(t=await this.coreProcessor.parseParams(e,{eventData:this.eventData}));let a=await(0,l.ZP)({...this.dataSource,params:t});return a=await this.parseDataAfterFetched(a),this.log("exec() return",a),a}}class S extends f{async exec(){this.log("exec() start, dataSource =",this.dataSource,"eventData =",this.eventData);const{dataKey:e,targetFormId:t}=this.dataSource;let a=this.coreProcessor.getFormModel();t&&(a=this.coreProcessor.getFormModelMap()[t]);const s=e?.split(".");while(s?.length>0){if(null==a){console.error("[FormModelDataSource]",e+" 读取异常，请检查数据结构");break}const t=s.shift();a=a[t]}return this.log("exec() return",a),a}}class M extends f{async exec(){this.log("exec() start, dataSource =",this.dataSource,"eventData =",this.eventData);const{dataKey:e}=this.dataSource,t=this.getQuery(e,location.href)||"";return this.log("exec() return",t),t}}class D extends f{async exec(){this.log("exec() start, dataSource =",this.dataSource,"eventData =",this.eventData);const{dataKey:e}=this.dataSource;let t=this.coreProcessor.getStore()?.state();const a=e?.split(".");while(a?.length>0){if(null==t){console.error("[StoreDataSource]",e+" 读取异常，请检查数据结构");break}const s=a.shift();t=t[s]}return this.log("exec() return",t),t}}class w extends f{async exec(){this.log("exec() start, dataSource =",this.dataSource,"eventData =",this.eventData);const{serviceName:e,args:t,params:a}=this.dataSource,s=this.coreProcessor.getDataService();if(s)try{let r={};a&&(r=await this.coreProcessor.parseParams(a));const o=await s.exec(e,{...t,...r,$event:this.eventData});return this.log("exec() return",o),o}catch(r){console.error("[DataServiceDataSource]",r)}else console.error("[DataServiceDataSource] - exec() error, cause dataService is null")}}class P extends f{async exec(){this.log("exec() start, dataSource =",this.dataSource,"eventData =",this.eventData);const{value:e}=this.dataSource;return this.log("exec() return",e),e}}class b extends f{async exec(){if(this.log("exec() start, dataSource =",this.dataSource,"eventData =",this.eventData),void 0===this.eventData)return console.warn("[EventContextDataSource]","eventData is undefined"),this.eventData;const{dataKey:e}=this.dataSource;let t=this.eventData;if(""===e||null==e)return this.log("exec() return",t),t;const a=e?.split(".");while(a?.length>0){if(null==t){console.error("[EventContextDataSource]",e+" 读取异常，请检查数据结构");break}const s=a.shift();t=t[s]}return this.log("exec() return",t),t}}function _(e,t,a={}){const{type:s}=t,r={template:g,api:x,window:y,formModel:S,pageUrl:M,store:D,constant:P,dataService:w,eventContext:b}[s];return new r(e,t,a)}class F{constructor(e,t,a){(0,c.Z)(this,"coreProcessor",new pe),(0,c.Z)(this,"eventHandle",void 0),(0,c.Z)(this,"eventData",void 0),this.coreProcessor=e,this.eventHandle=t,this.eventData=a}async exec(){}log(...e){window.__debug_log__&&console.log(`[eventHandle/${this.eventHandle.type}]`,...e)}async parseConditions(e){let t=!0;const{conditions:a,conditionType:s="every"}=e||{};return a&&(t=await this.coreProcessor.parseConditions(a,s,this.eventData)),t}}class C extends F{async exec(){this.log("exec() start, eventHandle =",this.eventHandle,"eventData =",this.eventData);let{targetFormItemId:e,value:t}=this.eventHandle;const{valueFrom:a}=this.eventHandle;a&&"condition"===a.type&&(t=await super.parseConditions(a));const s=await super.parseConditions(this.eventHandle),r=this.coreProcessor.getStore()?.state()?.metadataMap||{},o=r[e];s&&o&&(o.disabled=+t)}}class I extends F{async exec(){this.log("exec() start, eventHandle =",this.eventHandle,"eventData =",this.eventData);let{targetFormItemId:e,value:t}=this.eventHandle;const{valueFrom:a}=this.eventHandle;a&&"condition"===a.type&&(t=await super.parseConditions(a));const s=await super.parseConditions(this.eventHandle),r=this.coreProcessor.getStore()?.state()?.metadataMap||{},o=r[e];s&&o&&(o.hidden=+t)}}class E extends F{async exec(){this.log("exec() start, eventHandle =",this.eventHandle,"eventData =",this.eventData);let{targetFormItemId:e,value:t}=this.eventHandle;const{valueFrom:a}=this.eventHandle;a&&"condition"===a.type&&(t=await super.parseConditions(a));const s=await super.parseConditions(this.eventHandle),r=this.coreProcessor.getStore()?.state()?.metadataMap||{},o=r[e];s&&o&&(o.required=+t)}}class H extends F{async exec(){this.log("exec() start, eventHandle =",this.eventHandle,"eventData =",this.eventData);const{formModelKey:e,eventDataKey:t,targetFormId:a}=this.eventHandle;let s=this.coreProcessor.getFormModel();a&&(s=this.coreProcessor.getFormModelMap()[a]);const r=this.eventData,o=(e,t)=>{let a=e;while(t.length>1){const e=t.shift();a=a[e]}return a};let n=s;const i=e.split(","),c=t.split(",");if(i[0].indexOf(":")>-1){let[e,t]=i[0].split(":");e=e.split("."),n=o(s,e),n=n[e.shift()],i.splice(0,1,t)}const l=e=>{i.forEach(((t,a)=>{const s=t.split("."),n=o(e,s),i=c[a].split("."),l=o(r,i);n[s.shift()]=l[i.shift()]}))};Array.isArray(n)?n.forEach((e=>{l(e)})):l(n)}}class O extends F{async exec(){this.log("exec() start, eventHandle =",this.eventHandle,"eventData =",this.eventData);const{dataSource:e,targetFormItemId:t,saveKey:a}=this.eventHandle,s=this.coreProcessor.getMetadataMap()||{},r=s[t];r&&(a&&(r[a]=await this.coreProcessor.parseDataSource(e,{eventData:this.eventData})),r.dataSource=e)}}class R extends F{async exec(){this.log("exec() start, eventHandle =",this.eventHandle,"eventData =",this.eventData);const{targetFormItemId:e,method:t}=this.eventHandle,a=this.coreProcessor.getPageInstance()?.$refs[e],s=a&&a[0];s&&s[t](this.eventData)}}class k extends F{async exec(){this.log("exec() start, eventHandle =",this.eventHandle,"eventData =",this.eventData);const{functionBody:e}=this.eventHandle,t={context:this.coreProcessor,$event:this.eventData};if(t&&"object"!==typeof t)throw new TypeError("args is not a object");let a=new Function("args",e);return a(t)}}class A extends F{async exec(){this.log("exec() start, eventHandle =",this.eventHandle,"eventData =",this.eventData);const{formModelKey:e,value:t}=this.eventHandle,a=this.coreProcessor.getFormModel();let s=a;const r=e.split(".");while(r.length>1)s=s[r.shift()];s[r.shift()]=t}}class $ extends F{async exec(){this.log("exec() start, eventHandle =",this.eventHandle,"eventData =",this.eventData);const{serviceName:e,args:t,params:a}=this.eventHandle,s=this.coreProcessor.getDataService();if(s)try{let r={};return a&&(r=await this.coreProcessor.parseParams(a)),await s.exec(e,{$event:this.eventData,...t,...r})}catch(r){console.error("[DataServiceEvent]",r)}else console.error("[DataServiceEvent] - exec() error, cause dataService is null")}}function Z(e,t,a,s={}){const{type:r}=t,o={updateDisabled:C,updateHidden:I,updateRequired:E,updateModel:H,resetModel:A,updateDataSource:O,callMethod:R,execFunction:k,dataService:$}[r];return new o(e,t,a,s)}class N{constructor(e,t){(0,c.Z)(this,"coreProcessor",new pe),(0,c.Z)(this,"expression",void 0),this.coreProcessor=e,this.expression=t}async exec(){return!1}log(...e){window.__debug_log__&&console.log(`[expression/${this.expression.expression}]`,...e)}}class T extends N{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"eventData",void 0),this.eventData=a}async exec(){this.log("exec() start, expression =",this.expression,"eventData =",this.eventData);const{leftOperate:e,leftDataSource:t,rightOperate:a,rightDataSource:s}=this.expression;let r=e,o=a;t&&(r=await this.coreProcessor.getDataSource(t,{eventData:this.eventData}).exec()),s&&(o=await this.coreProcessor.getDataSource(s,{eventData:this.eventData}).exec());let n=r!==o;return"!="===this.expression.expression&&(n=r!=o),this.log("exec() return",n),n}}class j extends N{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"eventData",void 0),this.eventData=a}async exec(){this.log("exec() start, expression =",this.expression,"eventData =",this.eventData);const{leftOperate:e,leftDataSource:t,rightOperate:a,rightDataSource:s}=this.expression;let r=e,o=a;t&&(r=await this.coreProcessor.getDataSource(t,{eventData:this.eventData}).exec()),s&&(o=await this.coreProcessor.getDataSource(s,{eventData:this.eventData}).exec());let n=r===o;return"=="===this.expression.expression&&(n=r==o),this.log("exec() return",n),n}}class L extends N{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"eventData",void 0),this.eventData=a}async exec(){this.log("exec() start, expression =",this.expression,"eventData =",this.eventData);const{leftOperate:e,leftDataSource:t}=this.expression;let a=e;t&&(a=await this.coreProcessor.getDataSource(t,{eventData:this.eventData}).exec());const s=Array.isArray(a)?!a?.length:!a;return this.log("exec() return",s),s}}class B extends N{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"eventData",void 0),this.eventData=a}async exec(){this.log("exec() start, expression =",this.expression,"eventData =",this.eventData);const{leftOperate:e,leftDataSource:t}=this.expression;let a=e;t&&(a=await this.coreProcessor.getDataSource(t,{eventData:this.eventData}).exec());const s=Array.isArray(a)?a?.length:a;return this.log("exec() return",s),s}}class K extends N{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"eventData",void 0),this.eventData=a}async exec(){this.log("exec() start, expression =",this.expression,"eventData =",this.eventData);const{leftOperate:e,leftDataSource:t,rightOperate:a,rightDataSource:s}=this.expression;let r=e,o=a;t&&(r=await this.coreProcessor.getDataSource(t,{eventData:this.eventData}).exec()),s&&(o=await this.coreProcessor.getDataSource(s,{eventData:this.eventData}).exec());const n=!!Array.isArray(r)&&null!=r.find((e=>e===o));return this.log("exec() return",n),n}}class U extends N{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"eventData",void 0),this.eventData=a}async exec(){this.log("exec() start, expression =",this.expression,"eventData =",this.eventData);const{leftOperate:e,leftDataSource:t,rightOperate:a,rightDataSource:s}=this.expression;let r=e,o=a;t&&(r=await this.coreProcessor.getDataSource(t,{eventData:this.eventData}).exec()),s&&(o=await this.coreProcessor.getDataSource(s,{eventData:this.eventData}).exec());const n=!!Array.isArray(r)&&null!=r.find((e=>e===o));return this.log("exec() return",n),!n}}function W(e,t,a={}){const{expression:s}=t,r={"==":j,"===":j,"!=":T,"!==":T,empty:L,findInArray:K,notFindInArray:U,notEmpty:B}[s];return new r(e,t,a)}class J{constructor(e,t,a){(0,c.Z)(this,"coreProcessor",new pe),(0,c.Z)(this,"handle",void 0),(0,c.Z)(this,"_id",void 0),this.coreProcessor=e,this.handle=t,this._id=a}async exec(){}log(...e){window.__debug_log__&&console.log(`[initHandle/${this.handle.type}]`,...e)}async parseConditions(e){let t=!0;const{conditions:a,conditionType:s="every"}=e||{};return a&&(t=await this.coreProcessor.parseConditions(a,s)),t}}class q extends J{async exec(){this.log("exec() start, handle =",this.handle);const{dataSource:e,targetFormId:t}=this.handle,a=this.coreProcessor.getStore()?.state()?.metadataMap[this._id];let s=this.coreProcessor.getFormModel();t&&(s=this.coreProcessor.getFormModelMap()[t]),a&&s&&this.coreProcessor.getDataSource(e).exec().then((e=>{s[a.name]=e}))}}class G extends J{async exec(){this.log("exec() start, handle =",this.handle);let{value:e}=this.handle;const{valueFrom:t}=this.handle;t&&"condition"===t.type&&(e=await super.parseConditions(t));const a=this.coreProcessor.getStore()?.state()?.metadataMap[this._id];a&&(a.disabled=+e)}}class Q extends J{async exec(){this.log("exec() start, handle =",this.handle);let{value:e}=this.handle;const{valueFrom:t}=this.handle;t&&"condition"===t.type&&(e=await super.parseConditions(t));const a=this.coreProcessor.getStore()?.state()?.metadataMap[this._id];a&&(a.hidden=+e)}}class V extends J{async exec(){this.log("exec() start, handle =",this.handle);let{value:e}=this.handle;const{valueFrom:t}=this.handle;t&&"condition"===t.type&&(e=await super.parseConditions(t));const a=this.coreProcessor.getStore()?.state()?.metadataMap[this._id];a&&(a.required=+e)}}class z extends J{async exec(){this.log("exec() start, handle =",this.handle)}}class X extends J{async exec(){this.log("exec() start, handle =",this.handle);const{serviceName:e,args:t,params:a}=this.handle,s=this.coreProcessor.getDataService();if(s)try{let r={};return a&&(r=await this.coreProcessor.parseParams(a)),await s.exec(e,{...t,...r})}catch(r){console.error("[DataServiceHandle]",r)}else console.error("[DataServiceHandle] - exec() error, cause dataService is null")}}class Y extends J{async exec(){this.log("exec() start, handle =",this.handle);const{value:e}=this.handle,t=this.coreProcessor.getStore()?.state()?.metadataMap[this._id];t&&(t.label=e)}}function ee(e,t,a,s={}){const{type:r}=t,o={model:q,disabled:G,hidden:Q,required:V,options:z,dataService:X,label:Y}[r];return new o(e,t,a,s)}class te{constructor(e,t){(0,c.Z)(this,"coreProcessor",new pe),(0,c.Z)(this,"param",void 0),this.coreProcessor=e,this.param=t}async exec(){}log(...e){window.__debug_log__&&console.log(`[param/${this.param.type}]`,...e)}getQuery(e=null,t=location.href,a=null,s=!1,r=!1){const o=t.split("?"),n=a||o[1];if(!n)return e?void 0:{};let i,c;const l={},d=n.split("&"),h=d.length;for(let p=0;p<h;p++)try{i=d[p].split("="),2===i.length&&(c=r?i[1]:decodeURIComponent(i[1]),l[i[0]]=c)}catch(u){console.error("[getQuery]",u)}return e?l[e]:l}}class ae extends te{async exec(){this.log("exec() start, param =",this.param);const{key:e,dataKey:t=""}=this.param,a={[e]:this.getQuery(t||e,location.href)||""};return this.log("exec() return",a),a}}class se extends te{async exec(){this.log("exec() start, param =",this.param);const{key:e,value:t}=this.param,a={[e]:t};return this.log("exec() return",a),a}}class re extends te{async exec(){this.log("exec() start, param =",this.param);let{key:e,dataKey:t}=this.param;t=t||e;let a=this.coreProcessor.getFormModel(),s={};if(t){const r=t.split(".");while(r.length>0){if(null==a){console.error("[FormModelParam]",t+" 读取异常，请检查数据结构");break}const e=r.shift();a=a[e]}s={[e]:a}}else s={...a};return this.log("exec() return",s),s}}class oe extends te{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"eventData",void 0),this.eventData=a}async exec(){this.log("exec() start, param =",this.param,"eventData",this.eventData);const{serviceName:e,args:t}=this.param,a=this.coreProcessor.getDataService();if(a)try{const s=await a.exec(e,t);return this.log("exec() return",s),s}catch(s){console.error("[DataServiceParam]",s)}else console.error("[DataServiceParam] - exec() error, cause dataService is null");return{}}}class ne extends te{constructor(e,t,{eventData:a}){super(e,t),(0,c.Z)(this,"eventData",void 0),this.eventData=a}async exec(){if(this.log("exec() start, param =",this.param,"eventData",this.eventData),void 0===this.eventData)return console.warn("[EventContextParam]","eventData is undefined"),this.eventData;const{key:e,dataKey:t}=this.param;let a=this.eventData;if(""===t||null==t)return this.log("exec() return",a),a;const s=t.split(".");while(s.length>0){if(null==a){console.error("[EventContextParam]",t+" 读取异常，请检查数据结构");break}const e=s.shift();a=a[e]}const r={[e]:a};return this.log("exec() return",r),r}}function ie(e,t,a={}){let{type:s}=t;s||("valueFrom"in t?s=t.valueFrom||"pageUrl":"value"in t&&(s="constant"));const r={pageUrl:ae,constant:se,formModel:re,dataService:oe,eventContext:ne}[s];return new r(e,t,a)}var ce={log(...e){console.log("[dataService]",...e)}};class le{constructor(e,t){(0,c.Z)(this,"coreProcessor",new pe),(0,c.Z)(this,"services",void 0),this.coreProcessor=e,this.services={...ce,...t}}async exec(e,t){if(this.services[e])return"function"===typeof this.services[e]?(t&&"string"===typeof t&&(t={args:t}),await this.services[e]({context:this.coreProcessor,dataService:this,...t})):this.services[e]}add(e,t){e&&t&&(this.services[e]=t)}remove(e){this.services[e]&&(this.services[e]="",delete this.services[e])}getServices(){return this.services}}class de{constructor(e){(0,c.Z)(this,"coreProcessor",new pe),this.coreProcessor=e}async getRemoteMetadata(e,t,a){if(e){let a={};try{a=await(0,l.AU)({code:e,version:t})}catch(r){console.error(r)}if(0===a.errcode&&a.data){let{standard:e,extend:t}=a.data;if(e&&(e=JSON.parse(e)),t){if(t=JSON.parse(t),+t.notMergeToStandard)return t;this.mergeMetadata(e,t)}if(e)return e}}const s=JSON.parse(JSON.stringify(a));return s}mergeMetadata(e,t){const a=(e,t)=>{Object.keys(t).forEach((s=>{null!=t[s]&&("object"===typeof t[s]&&null==e[s]?e[s]=t[s]:"object"===typeof t[s]&&"object"===typeof e[s]?a(e[s],t[s]):e[s]=t[s],Array.isArray(e[s])&&(e[s]=e[s].filter((e=>!+e.delete))))}))};a(e,t)}parseComponents(e){const{_initRulesMap:t,_metadataMap:a,_eventListenerMap:s}=this.getInfoByParseMetadata(e);this.coreProcessor.updateInitRulesMap(t),this.coreProcessor.updateMetadataMap(a),this.coreProcessor.updateEventListenerMap(s)}getInfoByParseMetadata(e){const t={},a={},s={},r=[...e];while(r.length>0){const e=r.pop();null!=e._id&&(a[e._id]=e),null!=e.slotName&&(a[e.slotName]=e),Array.isArray(e)?r.push(...e):(e.eventListener&&e.eventListener.length&&(s[e._id]=e.eventListener),e.initRules&&e.initRules.length&&(t[e._id]=e.initRules),e.components&&e.components.length&&r.push(...e.components))}return{_initRulesMap:t,_metadataMap:a,_eventListenerMap:s}}}class he{constructor(e){(0,c.Z)(this,"coreProcessor",new pe),this.coreProcessor=e}async parseInitData(){const e=this.coreProcessor.getStore()?.state()?.metadata,t=e.initFormMode;if(t){const{url:e,method:s="get",params:r,dataKey:o="data",conditions:n,conditionType:i}=t,c=await this.coreProcessor.parseConditions(n,i);if(c){const n=await this.coreProcessor.parseParams(r);let i={};try{i=await(0,l.ZP)({method:s,url:e,params:n,dataKey:o})}catch(a){console.error(a)}const{parseServiceName:c}=t;if(c){const e=this.coreProcessor.getDataService();i=await e.exec(c,{$event:i})}if(i)return i}}return null}async parseFormModel(e){const t={},a={};let s=1;const r=(e,a)=>{e.forEach((e=>{if(null==e._id&&e.type&&(e._id=e.type+"_"+s++),null!=e._id&&(t[e._id]=a),e.name)if(e.components&&e.components.length){const t={};r(e.components,t),Array.isArray(e.value)?(a[e.name]=e.value,a[e.name].push(t)):a[e.name]=t}else a[e.name]=null!=e.value?e.value:"";else e.value&&"object"===typeof e.value?Object.keys(e.value).forEach((t=>{a[t]=e.value[t]})):Array.isArray(e)?r(e,a):e.components&&e.components.length&&r(e.components,a)}))};r(e,a);const o=this.coreProcessor.getStore()?.state()?.formModelMap;return this.coreProcessor.getStore()?.commit("updateFormModelMap",{...o,...t}),a}}const ue=(...e)=>{window.__debug_log__&&console.log("[core]",...e)};class pe{constructor(e){(0,c.Z)(this,"rootInstances",void 0),(0,c.Z)(this,"keysSavedInWindow",void 0),this.rootInstances=e,e&&e.$on("hook:destroyed",(()=>{this.clear()}))}async parseFormModel(e){const t=this.getFormModelHandler(),a=await t.parseInitData();this.getStore()?.commit("updateInitFormData",a);const s=await t.parseFormModel(e);return Object.assign(s,a),this.getStore()?.commit("updateFormModel",s),s}async parseComponents(e){return this.getMetadataHandler().parseComponents(e)}async parseGlobalConfig(e){if(e.footerBtns){const t=this.getStore()?.state()?.metadataMap,a=this.getStore()?.state()?.initRulesMap;t&&a&&e.footerBtns.forEach((e=>{e._id&&(t[e._id]=e,e.initRules&&(a[e._id]=e.initRules))}))}if(e.dataSource){const t=[],a=[],s=[];let r=[];r=Array.isArray(e.dataSource)?e.dataSource:[e.dataSource],r.forEach((e=>{e.saveKey&&(t.push(e.saveKey),a.push(e.saveType||"window"),s.push(this.parseDataSource(e)))}));const o=await Promise.all(s);t.forEach(((e,t)=>{"store"===a[t]?this.getStore()?.commit(`update${e[0].toUpperCase()}${e.substr(1)}`,o[t]):(window[Symbol.for(e)]=o[t],this.keysSavedInWindow=this.keysSavedInWindow||[],this.keysSavedInWindow.push(e))}))}}async parseDataSource(e,t){const a=await this.getDataSource(e,t).exec();return a}async parseMultipleDataSource(e,t){if(t){const a=[],s=[];let r=[];r=Array.isArray(t)?t:[t],r.forEach((e=>{e.saveKey&&(a.push(e.saveKey),s.push(this.parseDataSource(e)))}));const o=await Promise.all(s);a.forEach(((t,a)=>{const s=t.split(".");let r=e;while(s.length>1){const e=s.shift();r[e]=r[e]||{},r=r[e]}r[s.shift()]=o[a]}))}}async parseConditions(e,t="every",a){if(!e||0===e.length)return!0;const s=[];for(let r=0;r<e.length;r++)s[r]=this.getCondition(e[r],{eventData:a}).exec();for(let r=0;r<e.length;r++)s[r]=await s[r];return"some"===t?s.some((e=>!!e)):s.every((e=>!!e))}parseEventHandles(e,t){e.forEach((e=>{this.getEventHandle(e,t).exec()}))}parseInitHandles(e,t){e.forEach((e=>{this.getInitHandle(e,t).exec()}))}async parseParams(e,t){const a={};if(Array.isArray(e)&&e.length>0)for(let s=0;s<e.length;s++){const r=await this.getParam(e[s],t).exec();Object.assign(a,r)}return a}handleComponentEvent(e,t,a){ue("handleComponentEvent()",{event:e,itemId:t,eventData:a});const s=this.getStore()?.state()?.eventListenerMap||{},r=s[t];r&&r.forEach((t=>{if(t.event===e){const{handles:e=[],conditions:s,conditionType:r}=t;this.parseConditions(s,r,a).then((t=>{t&&this.parseEventHandles(e,a)}))}}))}handleInitRules({_initRulesMap:e=null,_metadataMap:t=null}={}){const a=t||this.getStore()?.state()?.metadataMap||{},s=e||this.getStore()?.state()?.initRulesMap||{};Object.keys(a).forEach((e=>{if(s[e]){const t=s[e];t.forEach((t=>{const{handles:a=[],conditions:s,conditionType:r}=t;this.parseConditions(s,r).then((t=>{t&&this.parseInitHandles(a,e)}))}))}}))}disableAll(e,t){const{conditions:a,conditionType:s}=e||{};this.parseConditions(a,s).then((e=>{if(e){const e=t||this.getStore()?.state()?.metadataMap||{};Object.values(e).forEach((e=>{e.disabled=1}))}}))}handleSubmit(e,t){return ue("handleSubmit()",{url:e,data:t}),(0,l.Ps)(e,t)}request(e){return(0,l.ZP)(e)}clear(){this.keysSavedInWindow?.length&&this.keysSavedInWindow.forEach((e=>{delete window[Symbol.for(e)]}))}getPageInstance(){const e=this.rootInstances?.type;return{formPage:this.rootInstances?.$refs?.formPageRef,listPage:this.rootInstances?.$refs?.listPageRef}[e]}getStore(){return this.rootInstances?.store}getTempData(){return this.getStore()?.state().tempData}getFormModel(){return this.getStore()?.state().formModel}getFormModelMap(){return this.getStore()?.state().formModelMap}getParentFormModelById(e){return this.getFormModelMap()[e]}getInfoByParseComponents(e){return this.getMetadataHandler().getInfoByParseMetadata(e)}getMetadataMap(){return this.getStore()?.state().metadataMap||{}}getMetadataById(e){return this.getMetadataMap()[e]}generateDataService(e){return new le(this,e)}getDataService(){return this.getStore()?.state()?.dataService}getMetadataHandler(){return new de(this)}getRemoteMetadata(e,t,a){return this.getMetadataHandler().getRemoteMetadata(e,t,a)}getFormModelHandler(){return new he(this)}getCondition(e,t){return v(this,e,t)}getDataSource(e,t){return _(this,e,t)}getEventHandle(e,t,a){return Z(this,e,t,a)}getExpresstion(e,t){return W(this,e,t)}getInitHandle(e,t,a){return ee(this,e,t,a)}getParam(e,t){return ie(this,e,t)}getGrayPublish(){return this.rootInstances?.$store?.state.app.grayPublish||{}}updateInitRulesMap(e){if(ue("updateInitRulesMap",e),e){const t=this.getStore()?.state()?.initRulesMap;this.getStore()?.commit("updateInitRulesMap",{...t,...e})}}updateMetadataMap(e){if(ue("updateMetadataMap",e),e){const t=this.getStore()?.state()?.metadataMap;this.getStore()?.commit("updateMetadataMap",{...t,...e})}}updateEventListenerMap(e){if(ue("updateEventListenerMap",e),e){const t=this.getStore()?.state()?.eventListenerMap;this.getStore()?.commit("updateEventListenerMap",{...t,...e})}}updateFormModelMap(e,t){if(ue("updateFormModelMap",t),e?.length&&t){const a={};e.forEach((e=>{a[e]=t}));const s=this.getStore()?.state()?.formModelMap;this.getStore()?.commit("updateFormModelMap",{...s,...a})}}}const me=window.__debug_log__,ve=(...e)=>{me&&console.log("[form]：",...e)};var fe={inject:["getStore"],props:{beforeCancel:{type:Function,default:()=>!0},beforeSubmit:{type:Function,default:()=>!0},afterSubmit:{type:Function,default:()=>!0},afterParseFormModel:{type:Function,default:()=>{}},beforeRender:{type:Function,default:()=>{}}},data(){return{metadata:null,loading:!1,ALL_COMPONENTS:i.Z,components:[],formModel:{},formModelBackUp:{}}},computed:{formTemplate(){return this.metadata||{}},slots(){return Object.keys(this.$scopedSlots)},metadataMap(){return this.getStore()?.state()?.metadataMap||{}}},watch:{},async mounted(){this.metadata=this.getStore()?.state()?.metadata,await this.parseMetadata()},methods:{async parseMetadata(){if(!this.metadata)return;if(this.loading=!0,ve("parseMetadata()",this.metadata),!this.validateMetadata())return void(this.loading=!1);let e=new pe;e=this.getStore()?.state()?.coreProcessor,this.formModel=await e.parseFormModel(this.metadata.components),this.afterParseFormModel&&await this.afterParseFormModel(this.formModel),await e.parseComponents(this.metadata.components),await e.parseGlobalConfig(this.metadata),this.metadata.disableAll&&await e.disableAll(this.metadata.disableAll),e.handleInitRules(),this.formModelBackUp=JSON.parse(JSON.stringify(this.formModel)),ve("parseFormModel()",this.formModel),this.beforeRender&&await this.beforeRender(this.formModel,this.metadata),this.components=this.metadata.components,setTimeout((()=>{this.loading=!1}),0)},validateMetadata(){if(!this.metadata||"object"!==typeof this.metadata)return!1;if(!this.metadata.components||!this.metadata.components.length)return!1;const e=this.metadata.components.find((e=>!this.ALL_COMPONENTS[e.type]&&!e.type.startsWith("el-")&&!["slot2"].includes(e.type)));return e?(console.error(`不支持 ${e.type} 表单组件`),!1):(ve("validateMetadata() - return true"),!0)},handleComponentEvent(e,t,a){ve("handleComponentEvent()",{event:e,formItemId:t,eventData:a});let s=new pe;s=this.getStore()?.state()?.coreProcessor,s.handleComponentEvent(e,t,a),this.$emit("event",e,t,a)},onFooterBtnClick(e){"cancel"===e?this.goBack():"submit"===e&&this.handleSubmit()},goBack(){const e=this.beforeCancel(this.formModel);!1!==e?this.$router.back():console.info("stop cancel, cause beforeCancel return false")},async handleSubmit(e){const t=this.formTemplate.submitConfig||{},{url:a,showError:s=1,autoBack:r=1}=t;if(!a)return void console.error("stop submit, cause submitConfig is invalid");const o=this.beforeSubmit(this.formModel);if(!1===o)return void console.info("stop submit, cause beforeSubmit return false");const n=await this.validate(s);if(!n)return;null==e&&(e=!r);let i=new pe;i=this.getStore()?.state()?.coreProcessor;const c=this.formModel;this.loading=!0;let l={};try{l=await i.handleSubmit(a,{...c})}catch(d){console.error(d),l=d}finally{this.loading=!1}!1!==this.afterSubmit(l)?0===l.errcode?(this.$message.success("提交成功"),e||this.goBack()):this.$message.error(l.errmsg||"提交失败"):console.info("stop exec, cause afterSubmit return false")},async validate(e){return new Promise((t=>{this.$refs.formRef.validate(((a,s)=>{if(ve("validate() - result =",a,s),!a&&e){const e=Object.values(s)[0][0].message;e&&this.$message.error(e)}t(a)}))}))},async validateField(e){return new Promise((t=>{this.$refs.formRef.validateField(e,(e=>{ve("validate() - result =",e),t(!e)}))}))},resetFields(){this.$refs.formRef.resetFields()},clearValidate(){this.$refs.formRef.clearValidate()},refresh(e){this.loading=!0,this.components=[],e?setTimeout((()=>{this.parseMetadata()}),0):(this.formModel=JSON.parse(JSON.stringify(this.formModelBackUp)),this.getStore()?.commit("updateFormModel",this.formModel),setTimeout((()=>{this.components=[...this.metadata.components],this.loading=!1}),0))},getFormModel(){return this.formModel}}},ge=fe,ye=a(9512),xe=(0,ye.Z)(ge,o,n,!1,null,"77ed8d7d",null),Se=xe.exports,Me=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[t("data-container",{attrs:{metadata:{components:e.components},"form-model":e.formModel},on:{event:e.handleComponentEvent},scopedSlots:e._u([e._l(e.slots,(function(t){return{key:t,fn:function(a){return[e._t(t,null,null,a)]}}}))],null,!0)})],1)},De=[],we=a(56593);const Pe=!1,be=(...e)=>{Pe&&console.log("[listPage]：",...e)};var _e={components:{DataContainer:we["default"]},inject:["getStore"],props:{afterParseFormModel:{type:Function,default:()=>{}}},data(){return{loading:!1,metadata:null,components:[],formModel:{}}},computed:{formTemplate(){return this.metadata||{}},slots(){return Object.keys(this.$scopedSlots)}},watch:{},async mounted(){this.metadata=this.getStore()?.state()?.metadata,this.parseMetadata()},destroyed(){},methods:{async parseMetadata(){if(!this.metadata)return;if(this.loading=!0,be("parseMetadata()",this.metadata),!this.validateMetadata())return void(this.loading=!1);let e=new pe;e=this.getStore()?.state()?.coreProcessor,this.formModel=await e.parseFormModel(this.metadata.components),this.afterParseFormModel&&await this.afterParseFormModel(this.formModel),await e.parseComponents(this.metadata.components),await e.parseGlobalConfig(this.metadata),e.handleInitRules(),be("parseFormModel()",this.formModel),this.components=this.metadata.components,setTimeout((()=>{this.loading=!1}),0)},validateMetadata(){return!(!this.metadata||"object"!==typeof this.metadata)&&(!(!this.metadata.components||!this.metadata.components.length)&&(be("validateMetadata() - return true"),!0))},handleComponentEvent(e,t,a){be("handleComponentEvent()",{event:e,formItemId:t,eventData:a});let s=new pe;s=this.getStore()?.state()?.coreProcessor,s.handleComponentEvent(e,t,a),this.$emit("event",e,t,a)},getFormModel(){return this.formModel}}},Fe=_e,Ce=(0,ye.Z)(Fe,Me,De,!1,null,"09cc74aa",null),Ie=Ce.exports,Ee=a(72204),He={components:{FormPage:Se,ListPage:Ie},provide(){return{getStore:this.getStore}},props:{metadata:{type:Object,require:!0},code:{type:String,default:""},version:{type:String,default:""},dataServiceData:{type:Object,default:null}},data(){return{loading:!1,type:"",store:{state:()=>{},commit:()=>{},dispatch:()=>{},statesToComputed:()=>{},register:()=>{},unregister:()=>{}}}},computed:{slots(){return Object.keys(this.$scopedSlots)}},watch:{},async mounted(){this.loading=!0;const e=new pe(this);let t=await e.getRemoteMetadata(this.code,this.version,this.metadata);const a=t?.store,s={coreProcessor:null,dataService:null,metadata:null,metadataMap:null,formModel:null,formModelMap:null,initFormData:null,eventListenerMap:null,initRulesMap:null,tempData:{},...a?.state};this.store=(0,Ee.zS)(a?.module||"config_module",s),this.store.commit("updateMetadata",t),this.store.commit("updateCoreProcessor",e),this.store.commit("updateDataService",e.generateDataService(this.dataServiceData));const r=t?.type;this.type=r||"formPage",this.loading=!1},destroyed(){this.store&&this.store.unregister()},methods:{getStore(){return this.store},getFormModel(){return this.$refs.formPageRef.formModel},async validate(e){return this.$refs.formPageRef.validate(e)},async validateField(e){return this.$refs.formPageRef.validateField(e)},resetFields(){return this.$refs.formPageRef.resetFields()},clearValidate(){return this.$refs.formPageRef.clearValidate()},refresh(e){return this.$refs.formPageRef.refresh(e)},submit(){return this.$refs.formPageRef.handleSubmit()}}},Oe=He,Re=(0,ye.Z)(Oe,s,r,!1,null,"4499fb54",null),ke=Re.exports},35026:function(e,t,a){function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function r(e,t){if("object"!=s(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function o(e){var t=r(e,"string");return"symbol"==s(t)?t:String(t)}function n(e,t,a){return t=o(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{Z:function(){return n}})}}]);